// lib/mockTransactions.js

// Comprehensive mock transactions for past 75 days (1 per day, mixed chronologically)
export const MOCK_TRANSACTIONS = [
    // Day 1 (75 days ago)
    { amount: 4500.00, category: "Income", description: "Monthly salary deposit" },
    // Day 2 
    { amount: -1245.00, category: "Bills & Utilities", description: "Monthly rent payment" },
    // Day 3
    { amount: -125.45, category: "Food & Dining", description: "Weekly grocery shopping" },
    // Day 4
    { amount: -45.75, category: "Transportation", description: "Gas fill-up" },
    // Day 5
    { amount: -89.50, category: "Entertainment", description: "Movie night with friends" },
    // Day 6
    { amount: -67.20, category: "Food & Dining", description: "Lunch meeting" },
    // Day 7
    { amount: -156.80, category: "Bills & Utilities", description: "Electricity bill" },
    // Day 8
    { amount: 850.00, category: "Freelance", description: "Web development project payment" },
    // Day 9
    { amount: -234.99, category: "Shopping", description: "Winter jacket purchase" },
    // Day 10
    { amount: -78.95, category: "Food & Dining", description: "Date night dinner" },
    // Day 11
    { amount: -95.00, category: "Transportation", description: "Car maintenance" },
    // Day 12
    { amount: -45.50, category: "Food & Dining", description: "Coffee and pastries" },
    // Day 13
    { amount: -189.50, category: "Transportation", description: "Car insurance payment" },
    // Day 14
    { amount: -125.00, category: "Entertainment", description: "Concert tickets" },
    // Day 15
    { amount: 300.50, category: "Investment", description: "Stock dividend payment" },
    // Day 16
    { amount: -89.50, category: "Bills & Utilities", description: "Internet and cable bill" },
    // Day 17
    { amount: -145.30, category: "Food & Dining", description: "Weekly grocery shopping" },
    // Day 18
    { amount: -67.25, category: "Transportation", description: "Uber rides" },
    // Day 19
    { amount: -175.00, category: "Healthcare", description: "Doctor visit copay" },
    // Day 20
    { amount: -56.75, category: "Food & Dining", description: "Takeout dinner" },
    // Day 21
    { amount: -299.99, category: "Education", description: "Online course subscription" },
    // Day 22
    { amount: -85.00, category: "Personal Care", description: "Haircut and styling" },
    // Day 23
    { amount: -92.75, category: "Food & Dining", description: "Weekend brunch" },
    // Day 24
    { amount: -78.25, category: "Shopping", description: "Clothing purchase" },
    // Day 25
    { amount: -67.25, category: "Bills & Utilities", description: "Water and sewage bill" },
    // Day 26
    { amount: -156.50, category: "Shopping", description: "Household supplies" },
    // Day 27
    { amount: 1200.00, category: "Freelance", description: "Logo design project" },
    // Day 28
    { amount: -45.75, category: "Entertainment", description: "Streaming services" },
    // Day 29
    { amount: -134.85, category: "Food & Dining", description: "Weekly groceries" },
    // Day 30
    { amount: -245.75, category: "Healthcare", description: "Dental cleaning" },
    // Day 31
    { amount: 4500.00, category: "Income", description: "Monthly salary deposit" },
    // Day 32
    { amount: -1245.00, category: "Bills & Utilities", description: "Monthly rent payment" },
    // Day 33
    { amount: -89.75, category: "Shopping", description: "Books and magazines" },
    // Day 34
    { amount: -67.25, category: "Healthcare", description: "Vitamins and supplements" },
    // Day 35
    { amount: -125.75, category: "Transportation", description: "Car service" },
    // Day 36
    { amount: -156.80, category: "Entertainment", description: "Weekend activities" },
    // Day 37
    { amount: -98.50, category: "Food & Dining", description: "Restaurant dinner" },
    // Day 38
    { amount: 275.00, category: "Investment", description: "Cryptocurrency gains" },
    // Day 39
    { amount: -345.80, category: "Shopping", description: "Electronics purchase" },
    // Day 40
    { amount: -78.00, category: "Transportation", description: "Metro monthly pass" },
    // Day 41
    { amount: -45.00, category: "Bills & Utilities", description: "Phone bill" },
    // Day 42
    { amount: -125.45, category: "Food & Dining", description: "Weekly grocery run" },
    // Day 43
    { amount: -95.00, category: "Gifts", description: "Birthday gift for friend" },
    // Day 44
    { amount: -67.50, category: "Food & Dining", description: "Work lunch" },
    // Day 45
    { amount: 980.00, category: "Freelance", description: "Mobile app consulting" },
    // Day 46
    { amount: -156.80, category: "Healthcare", description: "Physical therapy session" },
    // Day 47
    { amount: -89.50, category: "Entertainment", description: "Gaming purchases" },
    // Day 48
    { amount: -145.60, category: "Shopping", description: "Home decor items" },
    // Day 49
    { amount: -78.95, category: "Food & Dining", description: "Weekend takeout" },
    // Day 50
    { amount: -350.00, category: "Travel", description: "Weekend getaway hotel" },
    // Day 51
    { amount: -125.50, category: "Travel", description: "Flight booking" },
    // Day 52
    { amount: -65.75, category: "Travel", description: "Vacation dining" },
    // Day 53
    { amount: -45.50, category: "Personal Care", description: "Spa treatment" },
    // Day 54
    { amount: 150.00, category: "Gift", description: "Cash gift received" },
    // Day 55
    { amount: -167.30, category: "Food & Dining", description: "Weekly groceries" },
    // Day 56
    { amount: -89.50, category: "Bills & Utilities", description: "Internet service renewal" },
    // Day 57
    { amount: -125.00, category: "Education", description: "Professional workshop" },
    // Day 58
    { amount: -75.25, category: "Gifts", description: "Holiday present" },
    // Day 59
    { amount: 320.75, category: "Investment", description: "Bond interest payment" },
    // Day 60
    { amount: -178.90, category: "Bills & Utilities", description: "Utility bills" },
    // Day 61
    { amount: 4500.00, category: "Income", description: "Monthly salary deposit" },
    // Day 62
    { amount: -1245.00, category: "Bills & Utilities", description: "Monthly rent payment" },
    // Day 63
    { amount: -145.80, category: "Food & Dining", description: "Weekly grocery shopping" },
    // Day 64
    { amount: -95.00, category: "Transportation", description: "Gas and car wash" },
    // Day 65
    { amount: -50.00, category: "Gifts", description: "Charity donation" },
    // Day 66
    { amount: -156.80, category: "Other", description: "Emergency repair" },
    // Day 67
    { amount: -67.25, category: "Food & Dining", description: "Lunch with colleagues" },
    // Day 68
    { amount: -89.50, category: "Entertainment", description: "Board game purchase" },
    // Day 69
    { amount: 200.00, category: "Other Income", description: "Tax refund" },
    // Day 70
    { amount: -125.45, category: "Food & Dining", description: "Weekly groceries" },
    // Day 71
    { amount: -45.00, category: "Education", description: "Technical books" },
    // Day 72
    { amount: -85.75, category: "Transportation", description: "Parking and tolls" },
    // Day 73
    { amount: -35.75, category: "Other", description: "Pet supplies" },
    // Day 74
    { amount: -58.25, category: "Food & Dining", description: "Sushi takeout" },
    // Day 75 (yesterday)
    { amount: -25.99, category: "Other", description: "Bank fees" }
];

/**
 * Generate sequential dates for the past 75 days
 */
export const generateSequentialDates = () => {
    const dates = [];
    const today = new Date();
    
    // Generate dates for past 75 days in chronological order
    for (let i = 75; i >= 1; i--) {
        const transactionDate = new Date(today);
        transactionDate.setDate(today.getDate() - i);
        
        // Set random time during business hours (9 AM - 6 PM)
        const randomHour = Math.floor(Math.random() * 9) + 9; // 9-17
        const randomMinute = Math.floor(Math.random() * 60);
        transactionDate.setHours(randomHour, randomMinute, 0, 0);
        
        dates.push(transactionDate);
    }
    
    return dates;
};

/**
 * Calculate accurate summary data from transactions
 */
export const calculateSummaryData = (transactions) => {
    const currentDate = new Date();
    const currentMonth = currentDate.getMonth();
    const currentYear = currentDate.getFullYear();
    
    let totalBalance = 0;
    let monthlyIncome = 0;
    let monthlySpent = 0;
    let yearlyIncome = 0;
    let yearlySpent = 0;
    
    transactions.forEach(tx => {
        const txDate = new Date(tx.date);
        const amount = tx.amount;
        
        // Update running balance
        totalBalance += amount;
        
        // Check if transaction is in current month
        if (txDate.getMonth() === currentMonth && txDate.getFullYear() === currentYear) {
            if (amount > 0) {
                monthlyIncome += amount;
            } else {
                monthlySpent += Math.abs(amount);
            }
        }
        
        // Check if transaction is in current year
        if (txDate.getFullYear() === currentYear) {
            if (amount > 0) {
                yearlyIncome += amount;
            } else {
                yearlySpent += Math.abs(amount);
            }
        }
    });
    
    return {
        totalBalance: Math.round(totalBalance * 100) / 100,
        monthlyIncome: Math.round(monthlyIncome * 100) / 100,
        monthlySpent: Math.round(monthlySpent * 100) / 100,
        yearlyIncome: Math.round(yearlyIncome * 100) / 100,
        yearlySpent: Math.round(yearlySpent * 100) / 100
    };
};

/**
 * Calculate category spending from transactions for budget creation
 */
export const calculateCategorySpending = (transactions) => {
    const categoryTotals = {};
    
    transactions.forEach(tx => {
        if (tx.amount < 0) { // Only expenses
            const category = tx.category;
            const amount = Math.abs(tx.amount);
            
            if (!categoryTotals[category]) {
                categoryTotals[category] = 0;
            }
            categoryTotals[category] += amount;
        }
    });
    
    return categoryTotals;
};

/**
 * Generate realistic monthly budget based on actual spending patterns
 */
export const generateMonthlyBudget = (transactions) => {
    const categorySpending = calculateCategorySpending(transactions);
    const categories = {};
    
    // Create budgets with 20-30% buffer above actual spending
    Object.entries(categorySpending).forEach(([category, totalSpent]) => {
        // Calculate average monthly spending (75 days ≈ 2.5 months)
        const avgMonthlySpent = totalSpent / 2.5;
        // Add 25% buffer for budget
        const budget = Math.round(avgMonthlySpent * 1.25);
        categories[category] = budget;
    });
    
    // Calculate total budget
    const totalBudget = Object.values(categories).reduce((sum, amount) => sum + amount, 0);
    
    return {
        categories,
        totalBudget
    };
};

/**
 * Generate realistic yearly budget
 */
export const generateYearlyBudget = (transactions) => {
    const monthlyBudget = generateMonthlyBudget(transactions);
    const categories = {};
    
    // Multiply monthly budgets by 12 for yearly
    Object.entries(monthlyBudget.categories).forEach(([category, monthlyAmount]) => {
        categories[category] = monthlyAmount * 12;
    });
    
    const totalBudget = Object.values(categories).reduce((sum, amount) => sum + amount, 0);
    
    return {
        categories,
        totalBudget
    };
};

/**
 * Prepare complete mock transactions with accurate running balances
 */
export const prepareMockTransactions = (userId) => {
    const dates = generateSequentialDates();
    let runningBalance = 0;
    const transactions = [];
    
    MOCK_TRANSACTIONS.forEach((transaction, index) => {
        runningBalance += transaction.amount;
        
        transactions.push({
            userId: userId,
            amount: transaction.amount,
            category: transaction.category,
            description: transaction.description,
            date: dates[index],
            runningBalance: Math.round(runningBalance * 100) / 100
        });
    });
    
    return {
        transactions,
        finalBalance: runningBalance,
        summaryData: calculateSummaryData(transactions)
    };
};